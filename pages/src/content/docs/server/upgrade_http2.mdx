---
title: å‡çº§ Http2 ğŸŒ
description: Feat Http2
sidebar:
    order: 6
---

import http2_architecture from './img/http2_architecture.svg';
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>

Feat æ”¯æŒé€šè¿‡ **HttpRequest.upgrade** æ–¹æ³•å°† HTTP/1.1 è¿æ¥å‡çº§åˆ° HTTP/2 åè®®ã€‚
<img src={http2_architecture.src} alt="HTTP/2åè®®æ ˆ" width="80%"/>

## å¿«é€Ÿå¼€å§‹
æ“ä½œç¤ºä¾‹å¦‚ä¸‹ï¼š
```java title=Http2Demo.java
public class Http2Demo {
    public static void main(String[] args) {
        Feat.httpServer().httpHandler(request -> {
            request.upgrade(new Http2Upgrade() {
                @Override
                public void handle(HttpRequest http2Request) {
                    HttpResponse response = http2Request.response();
                    response.setStatus(200);
                    response.send("HTTP/2å“åº”");
                }
            });
        }).listen();
    }
}
```

## æ ¸å¿ƒæœºåˆ¶
1. **åè®®åå•†**ï¼šé€šè¿‡`Connection: Upgrade`å’Œ`Upgrade: h2c`å¤´éƒ¨å®Œæˆæ¡æ‰‹
2. **å¤šè·¯å¤ç”¨**ï¼šåŸºäºStream IDå®ç°è¯·æ±‚å¹¶å‘å¤„ç†
3. **å¤´éƒ¨å‹ç¼©**ï¼šé‡‡ç”¨HPACKç®—æ³•å‹ç¼©è¯·æ±‚å¤´
4. **æœåŠ¡ç«¯æ¨é€**ï¼šé€šè¿‡PushBuilderå®ç°èµ„æºé¢„æ¨é€

## é…ç½®å‚æ•°
Http2Upgrade æä¾›ä»¥ä¸‹æ„é€ æ–¹æ³•ï¼š
```java
public Http2Upgrade() {
    this(120000); // é»˜è®¤ç©ºé—²è¶…æ—¶120ç§’
}

public Http2Upgrade(long idleTimeout) {
    this.idleTimeout = idleTimeout;
}
```

## æ€§èƒ½ä¼˜åŒ–
1. å¯ç”¨HPACKå‹ç¼©ï¼šåˆå§‹åŒ–æ—¶è®¾ç½®`enableHeaderCompression=true`
2. è°ƒæ•´æµæ§çª—å£ï¼šé€šè¿‡`Http2Settings.initialWindowSize(1048576)`
3. æœåŠ¡ç«¯æ¨é€é…ç½®ï¼š
```java
http2Request.push()
    .path("/static/style.css")
    .send();
```
4. ä¿æŒé•¿è¿æ¥ï¼šè®¾ç½®åˆç†çš„`idleTimeout`å€¼



