---
title: åº”ç”¨å‘å¸ƒæŒ‡å— ğŸŒ
description: ä»æ‰“åŒ…åˆ°éƒ¨ç½²çš„æœ€ä½³å®è·µ
sidebar:
    order: 5
---

import {Aside} from '@astrojs/starlight/components';
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>

æœ¬ç« èŠ‚å°†æŒ‡å¯¼æ‚¨å¦‚ä½•å°† Feat åº”ç”¨æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚æˆ‘ä»¬å°†ä»‹ç»ä»æ„å»ºå¯æ‰§è¡Œ jar åŒ…åˆ°å®¹å™¨åŒ–éƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚

## æ„å»ºå¯æ‰§è¡Œ jar

Feat åº”ç”¨å¯ä»¥é€šè¿‡ Maven çš„ `maven-shade-plugin` æ’ä»¶æ‰“åŒ…æˆä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¾èµ–çš„å¯æ‰§è¡Œ jar åŒ…ï¼ˆä¹Ÿç§°ä¸º fat jarï¼‰ã€‚

åœ¨ `pom.xml` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```xml title="pom.xml"
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-shade-plugin</artifactId>
            <version>3.5.0</version>
            <executions>
                <execution>
                    <phase>package</phase>
                    <goals>
                        <goal>shade</goal>
                    </goals>
                    <configuration>
                        <transformers>
                            <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                <mainClass>your.package.MainClass</mainClass>
                            </transformer>
                        </transformers>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

<Aside>
    è¯·å°† `your.package.MainClass` æ›¿æ¢ä¸ºæ‚¨çš„ä¸»ç±»çš„å®Œæ•´ç±»åã€‚
</Aside>

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼š

```bash
mvn clean package
```

## æ„å»º Docker é•œåƒ

### ç¼–å†™ Dockerfile

åˆ›å»º `Dockerfile` æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```dockerfile title="Dockerfile"
# ä½¿ç”¨ JRE åŸºç¡€é•œåƒ
FROM eclipse-temurin:8-jre

# è®¾ç½®å·¥ä½œç›®å½•
WORKDOME /app

# å¤åˆ¶ jar åŒ…
COPY target/your-application.jar app.jar

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV JAVA_OPTS=""

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

### æ„å»ºé•œåƒ

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º Docker é•œåƒï¼š

```bash
docker build -t your-application:latest .
```

## å¤šç¯å¢ƒé…ç½®ç®¡ç†

Feat æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ç®¡ç†ï¼Œè¿™åœ¨å®¹å™¨åŒ–éƒ¨ç½²æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚

### é…ç½®ä¼˜å…ˆçº§

1. å‘½ä»¤è¡Œå‚æ•°
2. ç¯å¢ƒå˜é‡
3. é…ç½®æ–‡ä»¶

### ç¯å¢ƒå˜é‡é…ç½®ç¤ºä¾‹

```bash
# è®¾ç½®æœåŠ¡ç«¯å£
export FEAT_SERVER_PORT=8080

# è®¾ç½®æ•°æ®åº“è¿æ¥
export FEAT_DB_URL=jdbc:mysql://localhost:3306/db_name
export FEAT_DB_USERNAME=root
export FEAT_DB_PASSWORD=password
```

## å®¹å™¨åŒ–éƒ¨ç½²ä¼˜åŒ–

### JVM è°ƒä¼˜

åœ¨å®¹å™¨ç¯å¢ƒä¸­è¿è¡Œ Java åº”ç”¨æ—¶ï¼Œå»ºè®®æ·»åŠ ä»¥ä¸‹ JVM å‚æ•°ï¼š

```bash
JAVA_OPTS="\
    -XX:+UseContainerSupport \
    -XX:InitialRAMPercentage=70.0 \
    -XX:MaxRAMPercentage=70.0 \
    -XX:+HeapDumpOnOutOfMemoryError"
```

### é•œåƒä¼˜åŒ–

1. ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒå¤§å°
2. åˆç†è®¾ç½® JVM å †å†…å­˜
3. ä½¿ç”¨ Alpine åŸºç¡€é•œåƒè¿›ä¸€æ­¥å‡å°ä½“ç§¯

### å¥åº·æ£€æŸ¥

åœ¨ Docker è¿è¡Œæ—¶æ·»åŠ å¥åº·æ£€æŸ¥ï¼š

```bash
docker run -d \
    --health-cmd="curl -f http://localhost:8080/health || exit 1" \
    --health-interval=5s \
    --health-retries=3 \
    your-application:latest
```

## éƒ¨ç½²ç¤ºä¾‹

### ä½¿ç”¨ Docker Compose

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š

```yaml title="docker-compose.yml"
version: '3'
services:
  app:
    image: your-application:latest
    ports:
      - "8080:8080"
    environment:
      - FEAT_SERVER_PORT=8080
      - JAVA_OPTS=-XX:+UseContainerSupport -XX:MaxRAMPercentage=70.0
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 3
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
docker-compose up -d
```

<Aside>
    åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨å®¹å™¨ç¼–æ’å·¥å…·ï¼ˆå¦‚ Kubernetesï¼‰è¿›è¡Œéƒ¨ç½²å’Œç®¡ç†ã€‚
</Aside>