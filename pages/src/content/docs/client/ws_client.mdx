---
title: 4.2 WebSocketè¯¦è§£ ğŸŒ
description: Feat Client
sidebar:
    order: 2
---
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>
éšç€ Web æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼ŒWebSocket å·²ç»æˆä¸ºå®æ—¶é€šä¿¡åº”ç”¨çš„é¦–é€‰æŠ€æœ¯ã€‚å®ƒèƒ½å¤Ÿå®ç°æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„å…¨åŒå·¥é€šä¿¡ï¼Œé€‚ç”¨äºå®æ—¶èŠå¤©ã€åœ¨çº¿æ¸¸æˆã€è‚¡ç¥¨äº¤æ˜“ã€ç‰©è”è®¾å¤‡æ§åˆ¶ç­‰åœºæ™¯ã€‚

WebSocketClient æ˜¯ Feat æ¡†æ¶ä¸­çš„ä¸€æ¬¾é«˜æ€§èƒ½ WebSocket å®¢æˆ·ç«¯å®ç°ï¼Œæ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›çµæ´»ã€é«˜æ•ˆã€æ˜“ç”¨çš„ WebSocket å¼€å‘ä½“éªŒã€‚

æœ¬æ–‡å°†è¯¦ç»†ä»‹ç» Feat WebSocketClient çš„åŠŸèƒ½ã€æ ¸å¿ƒæ¥å£ä»¥åŠä½¿ç”¨æ–¹æ³•ã€‚

---

## 1. æ ¸å¿ƒåŠŸèƒ½

Feat WebSocketClient æä¾›äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **WebSocket è¿æ¥ç®¡ç†**ï¼š
- æ”¯æŒ WebSocket åè®®ï¼ˆws:// å’Œ wss://ï¼‰ã€‚
- æ”¯æŒè¿æ¥å»ºç«‹ã€æ–­å¼€ã€é‡è¿ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
- æä¾›è¿æ¥çŠ¶æ€ç›‘æ§å’Œäº‹ä»¶é€šçŸ¥ã€‚

2. **æ¶ˆæ¯ä¼ è¾“**ï¼š
- æ”¯æŒæ–‡æœ¬æ¶ˆæ¯ï¼ˆStringï¼‰å’ŒäºŒè¿›åˆ¶æ¶ˆæ¯ï¼ˆbyte[]ï¼‰çš„å‘é€ä¸æ¥æ”¶ã€‚
- æ”¯æŒæ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚

3. **äº‹ä»¶ç›‘å¬**ï¼š
- æä¾› `onOpen`ï¼ˆè¿æ¥æˆåŠŸï¼‰ã€`onClose`ï¼ˆè¿æ¥å…³é—­ï¼‰ã€`onError`ï¼ˆå‘ç”Ÿé”™è¯¯ï¼‰ã€`onMessage`ï¼ˆæ¥æ”¶æ¶ˆæ¯ï¼‰ç­‰äº‹ä»¶å›è°ƒï¼Œæ–¹ä¾¿å¼€å‘è€…å¤„ç†å„ç§åœºæ™¯ã€‚

4. **é…ç½®çµæ´»**ï¼š
- æ”¯æŒè®¾ç½®è¿æ¥è¶…æ—¶ã€è¯»å†™ç¼“å†²åŒºå¤§å°ã€ä»£ç†é…ç½®ç­‰ã€‚
- æ”¯æŒè‡ªå®šä¹‰ SSL/TLS é…ç½®ï¼Œæ»¡è¶³å®‰å…¨é€šä¿¡éœ€æ±‚ã€‚

---

## 2. æ ¸å¿ƒæ¥å£

Feat WebSocketClient çš„æ ¸å¿ƒæ¥å£åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

### 2.1 WebSocketClient ç±»

`WebSocketClient` æ˜¯å®¢æˆ·ç«¯çš„ä¸»è¦å…¥å£ç±»ï¼Œæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š

- **æ„é€ æ–¹æ³•**ï¼š
```java
public WebSocketClient(String url)
  ```
ä½¿ç”¨ WebSocket URL åˆå§‹åŒ–å®¢æˆ·ç«¯å®ä¾‹ï¼Œæ”¯æŒ `ws://` å’Œ `wss://` åè®®ã€‚

- **é…ç½®æ–¹æ³•**ï¼š
```java
public WebSocketOptions options()
  ```
è·å–é…ç½®å¯¹è±¡ï¼Œç”¨äºè®¾ç½®å®¢æˆ·ç«¯çš„å„é¡¹å‚æ•°ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€è¯»å†™ç¼“å†²åŒºå¤§å°ã€ä»£ç†ç­‰ã€‚

- **è¿æ¥æ–¹æ³•**ï¼š
```java
public void connect(WebSocketListener listener)
  ```
ä½¿ç”¨æŒ‡å®šçš„ç›‘å¬å™¨å»ºç«‹ WebSocket è¿æ¥ã€‚

- **å‘é€æ¶ˆæ¯**ï¼š
```java
public void sendMessage(String message) throws IOException
public void sendBinary(byte[] bytes) throws IOException
  ```
å‘é€æ–‡æœ¬æ¶ˆæ¯æˆ–äºŒè¿›åˆ¶æ¶ˆæ¯ã€‚

- **å…³é—­è¿æ¥**ï¼š
```java
public void close()
  ```
å…³é—­ WebSocket è¿æ¥ã€‚

### 2.2 WebSocketListener æ¥å£

`WebSocketListener` æ˜¯äº‹ä»¶ç›‘å¬æ¥å£ï¼Œå®šä¹‰äº†ä»¥ä¸‹æ–¹æ³•ï¼š

- **onOpen**ï¼š
```java
void onOpen(WebSocketClient client, WebSocketResponse response)
  ```
è¿æ¥æˆåŠŸæ—¶è§¦å‘ã€‚

- **onClose**ï¼š
```java
void onClose(WebSocketClient client, WebSocketResponse response, CloseReason reason)
  ```
è¿æ¥å…³é—­æ—¶è§¦å‘ã€‚

- **onError**ï¼š
```java
void onError(WebSocketClient client, WebSocketResponse response, Throwable throwable)
  ```
å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘ã€‚

- **onMessage**ï¼š
```java
void onMessage(WebSocketClient client, String message)
void onMessage(WebSocketClient client, byte[] message)
  ```
æ¥æ”¶åˆ°æ–‡æœ¬æ¶ˆæ¯æˆ–äºŒè¿›åˆ¶æ¶ˆæ¯æ—¶è§¦å‘ã€‚

### 2.3 WebSocketOptions ç±»

`WebSocketOptions` æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼ŒåŒ…æ‹¬ï¼š

- **è®¾ç½®è¿æ¥è¶…æ—¶**ï¼š
```java
public WebSocketOptions connectTimeout(int connectTimeout)
  ```

- **è®¾ç½®ä»£ç†**ï¼š
```java
public WebSocketOptions proxy(String host, int port, String username, String password)
  ```

- **è®¾ç½®è¯»å†™ç¼“å†²åŒºå¤§å°**ï¼š
```java
public WebSocketOptions readBufferSize(int readBufferSize)
public WebSocketOptions writeBufferSize(int writeBufferSize)
  ```

- **å¯ç”¨è°ƒè¯•æ¨¡å¼**ï¼š
```java
public WebSocketOptions debug(boolean debug)
  ```

---

## 3. ä½¿ç”¨ç¤ºä¾‹

### 3.1 åŸºæœ¬ç”¨æ³•

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Feat WebSocketClient è¿æ¥ WebSocket æœåŠ¡å™¨å¹¶å¤„ç†æ¶ˆæ¯ï¼š

```java
import tech.smartboot.feat.core.client.WebSocketClient;
import tech.smartboot.feat.core.client.WebSocketListener;
import tech.smartboot.feat.core.client.WebSocketResponse;

public class WebSocketDemo {
    public static void main(String[] args) {
        WebSocketClient client = new WebSocketClient("ws://localhost:8080/ws");
        client.options().debug(true); // å¼€å¯è°ƒè¯•æ¨¡å¼

        client.connect(new WebSocketListener() {
            @Override
            public void onOpen(WebSocketClient client, WebSocketResponse response) {
                System.out.println("WebSocket è¿æ¥æˆåŠŸ");
                try {
                    client.sendMessage("Hello Feat WebSocket");
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }

            @Override
            public void onMessage(WebSocketClient client, String message) {
                System.out.println("æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
            }

            @Override
            public void onClose(WebSocketClient client, WebSocketResponse response, CloseReason reason) {
                System.out.println("WebSocket è¿æ¥å…³é—­ï¼Œå…³é—­åŸå› ï¼š" + reason);
            }

            @Override
            public void onError(WebSocketClient client, WebSocketResponse response, Throwable throwable) {
                System.out.println("å‘ç”Ÿé”™è¯¯ï¼š" + throwable.getMessage());
            }
        });
    }
}
```

### 3.2 é«˜çº§é…ç½®

å¦‚æœéœ€è¦è‡ªå®šä¹‰è¿æ¥å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ `WebSocketOptions` è¿›è¡Œé…ç½®ï¼š

```java
WebSocketClient client = new WebSocketClient("wss://example.com/ws");
WebSocketOptions options = client.options();
options.connectTimeout(5000) // è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ä¸º 5 ç§’
       .readBufferSize(8192) // è®¾ç½®è¯»ç¼“å†²åŒºå¤§å°ä¸º 8 KB
       .proxy("proxy.example.com", 8080, "user", "password") // è®¾ç½®ä»£ç†æœåŠ¡å™¨
       .debug(true); // å¼€å¯è°ƒè¯•æ¨¡å¼

client.connect(listener);
```

---

## 4. æ€§èƒ½ä¸æ‰©å±•æ€§

### 4.1 é«˜æ€§èƒ½

Feat WebSocketClient åŸºäº Feat æ¡†æ¶çš„é«˜æ€§èƒ½ç½‘ç»œé€šä¿¡èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ”¯æŒå¤§è§„æ¨¡çš„å¹¶å‘è¿æ¥å’Œé«˜é¢‘ç‡çš„æ¶ˆæ¯ä¼ è¾“ã€‚é€šè¿‡åˆç†é…ç½®è¯»å†™ç¼“å†²åŒºå¤§å°å’Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚

### 4.2 çµæ´»æ€§

Feat WebSocketClient æ”¯æŒè‡ªå®šä¹‰ SSL/TLS é…ç½®ï¼Œé€‚ç”¨äºéœ€è¦å®‰å…¨é€šä¿¡çš„åœºæ™¯ã€‚åŒæ—¶ï¼Œé€šè¿‡ `WebSocketListener` æ¥å£ï¼Œå¼€å‘è€…å¯ä»¥çµæ´»åœ°å®šä¹‰æ¶ˆæ¯å¤„ç†é€»è¾‘ã€‚

### 4.3 çº¿ç¨‹å®‰å…¨

Feat WebSocketClient çš„è®¾è®¡å……åˆ†è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¿è¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ã€‚

---

## 5. æ€»ç»“

Feat WebSocketClient æ˜¯ä¸€æ¬¾åŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½ä¼˜è¶Šçš„ WebSocket å®¢æˆ·ç«¯å®ç°ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§å¤šæ•°å®æ—¶é€šä¿¡åœºæ™¯çš„éœ€æ±‚ã€‚é€šè¿‡ç®€å•çš„ API å’Œçµæ´»çš„é…ç½®é€‰é¡¹ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿæ„å»ºé«˜æ•ˆçš„ WebSocket åº”ç”¨ã€‚

å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€æ¬¾é«˜æ€§èƒ½ã€æ˜“ç”¨çš„ WebSocket å®¢æˆ·ç«¯ï¼ŒFeat WebSocketClient æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰æ‹©ã€‚