---
title: Embedding
description: Feat AI 文本嵌入功能 - 将文本转换为向量表示
sidebar:
    order: 4
---

import { Aside } from '@astrojs/starlight/components';
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>

Embedding Model 用于将文本转换为数值向量（高维空间中的点），使计算机能够理解和比较文本的语义含义。

## 概述

文本嵌入是以下应用的基础：

- **语义搜索** - 找到与查询语义相似的文档
- **文本分类** - 基于语义将文本归类
- **聚类分析** - 发现文本之间的相似性分组
- **推荐系统** - 推荐语义相似的内容

Feat AI 提供统一的 `EmbeddingModel` 接口，支持多种嵌入模型供应商。

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.embedding.EmbeddingModel;
import tech.smartboot.feat.ai.vendor.EmbeddingModelVendor;

// 创建嵌入模型
EmbeddingModel model = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BGE_M3)
);

// 生成向量
List<Float> vector = model.embed("这是一段文本");
```

## 快速开始

### 单句嵌入

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.embedding.EmbeddingModel;
import tech.smartboot.feat.ai.vendor.EmbeddingModelVendor;

EmbeddingModel model = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BGE_M3)
);

// 对单句文本进行嵌入
float[] embedding = model.embed("你好！");
System.out.println("向量维度: " + embedding.length);  // 768
```

### 批量嵌入

```java
import java.util.Arrays;
import java.util.List;

EmbeddingModel model = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BGE_LARGE_ZH_V1_5)
);

List<float[]> embeddings = model.embed(Arrays.asList(
    "Hello World",
    "你好"
));

embeddings.forEach(embed -> 
    System.out.println(Arrays.toString(embed))
);
```

## 模型选择

### GiteeAI 模型

```java
// 基础版模型
EmbeddingModel bceBaseModel = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BCE_BASE_V1)
);

// 小型中文模型
EmbeddingModel bgeSmallModel = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BGE_SMALL_ZH_V1_5)
);

// 大型中文模型
EmbeddingModel bgeLargeModel = FeatAI.embedding(opts -> opts
    .model(EmbeddingModelVendor.GiteeAI.BGE_LARGE_ZH_V1_5)
);
```

### Ollama 本地模型

```java
EmbeddingModel ollamaModel = FeatAI.embedding(opts -> {
    opts.baseUrl("http://localhost:11434/v1")
        .model(EmbeddingModelVendor.Ollama.NOMIC_EMBED_TEXT);
});

List<float[]> embeddings = ollamaModel.embed(Arrays.asList(
    "Hello World",
    "你好"
));
```

<Aside type="note">
需要先启动 Ollama 服务。`nomic-embed-text` 是一个高性能的开源嵌入模型。
</Aside>

### 自定义模型

```java
EmbeddingModel customModel = FeatAI.embedding(opts -> {
    opts.baseUrl("http://your-model-server/v1")
        .model("your-model-name")
        .apiKey("your-api-key");
});
```

## 使用示例

### 文本相似度计算

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.vendor.EmbeddingModelVendor;

public class TextSimilarityExample {
    public static void main(String[] args) {
        EmbeddingModel model = FeatAI.embedding(opts -> opts
            .model(EmbeddingModelVendor.GiteeAI.BCE_BASE_V1)
        );

        float[] embedding1 = model.embed("你好！");
        float[] embedding2 = model.embed("您好！");

        // 计算余弦相似度
        double similarity = cosineSimilarity(embedding1, embedding2);
        System.out.println("文本相似度: " + similarity);  // 0.85+
    }

    private static double cosineSimilarity(float[] a, float[] b) {
        double dotProduct = 0.0;
        double normA = 0.0;
        double normB = 0.0;

        for (int i = 0; i < a.length; i++) {
            dotProduct += a[i] * b[i];
            normA += Math.pow(a[i], 2);
            normB += Math.pow(b[i], 2);
        }

        return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
    }
}
```

### 与 Chroma 集成

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.vector.VectorStore;
import tech.smartboot.feat.ai.vector.Document;

// 创建带嵌入模型的向量存储
VectorStore store = VectorStore.chroma(opts -> opts
    .url("http://localhost:8000")
    .collectionName("my_collection")
    .embeddingModel(FeatAI.embedding(embedOpts -> 
        embedOpts.model(EmbeddingModelVendor.GiteeAI.BGE_M3)
    ))
);

// 添加文档（自动嵌入）
Document doc = new Document("doc1", "Feat AI 是一个 Java AI 开发框架");
store.add(doc);

// 语义搜索
List<Document> results = store.similaritySearch("什么是 Feat AI", 5);
```

## API 参考

### FeatAI

| 方法 | 说明 |
|------|------|
| `embedding(Consumer<EmbeddingOptions>)` | 创建 EmbeddingModel 实例 |

### EmbeddingOptions

| 方法 | 说明 |
|------|------|
| `model(EmbeddingModelVendor)` | 选择嵌入模型 |
| `baseUrl(String)` | 自定义 API 地址 |
| `apiKey(String)` | 设置 API 密钥 |
| `debug(boolean)` | 启用调试 |

### EmbeddingModel

| 方法 | 说明 |
|------|------|
| `embed(String)` | 嵌入单句文本 |
| `embed(List<String>)` | 批量嵌入 |
