---
title: Chroma Vector Store
description: Feat AI Chroma 向量存储 - 轻量级向量数据库集成
sidebar:
    order: 5
---

import { Aside } from '@astrojs/starlight/components';
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>

Chroma 是一个开源的向量数据库，专为存储和检索高维向量设计。Feat AI 通过 `VectorStore` 接口提供与 Chroma 的无缝集成。

## 概述

Vector Store 用于：

- **存储文档向量** - 将文本及其嵌入向量持久化存储
- **语义检索** - 基于向量相似度搜索相关内容
- **元数据过滤** - 结合语义和结构化条件检索

## 快速开始

### 启动 Chroma 服务

```bash
docker run -p 8000:8000 chromaai/chroma:latest
```

服务启动后，Chroma API 将运行在 `http://localhost:8000`。

### 基本使用

```java
import tech.smartboot.feat.ai.vector.VectorStore;
import tech.smartboot.feat.ai.vector.Document;
import tech.smartboot.feat.ai.vector.SearchRequest;

// 创建向量存储
VectorStore store = VectorStore.chroma(opts -> opts
    .setUrl("http://localhost:8000")
);

// 添加文档
Document doc = new Document();
doc.setId("doc1");
doc.setDocument("Feat AI 是一个 Java AI 开发框架");
doc.setMetadata(Map.of("source", "docs", "category", "intro"));
store.add(doc);

// 语义搜索
SearchRequest request = new SearchRequest();
request.setQuery("什么是 Feat AI");

List<Document> results = store.similaritySearch(request);
```

<Aside type="note">
- `setUrl()` 用于配置 Chroma 服务地址
- `Document` 使用 setter 方法设置属性
</Aside>

## 核心概念

### Document

`Document` 是 Vector Store 中的基本存储单元：

```java
Document doc = new Document();
doc.setId("unique-id");           // 文档唯一标识
doc.setDocument("文本内容");       // 文本内容（自动嵌入）
doc.setMetadata(Map.of(           // 元数据（可选）
    "source", "https://example.com",
    "author", "张三"
));
```

### Collection

Collection 是 Chroma 中存储向量的容器：

```java
import tech.smartboot.feat.ai.vector.chroma.Chroma;

Chroma chroma = new Chroma("http://localhost:8000");

// 创建集合
Collection collection = chroma.createCollection("my_collection");

// 获取集合
Collection existing = chroma.getCollection("my_collection");

// 删除集合
collection.delete();
```

## 使用指南

### 配置嵌入模型

Vector Store 需要嵌入模型将文本转换为向量：

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.embedding.EmbeddingModelVendor;

VectorStore store = VectorStore.chroma(opts -> opts
    .setUrl("http://localhost:8000")
    .embeddingModel(FeatAI.embedding(embedOpts ->
        embedOpts.model(EmbeddingModelVendor.GiteeAI.BGE_M3)
    ))
);
```

<Aside type="note">
如果不配置嵌入模型，Vector Store 将无法自动将文本转换为向量。你也可以手动提供向量。
</Aside>

### 添加和删除文档

```java
// 添加单个文档
Document doc1 = new Document();
doc1.setId("1");
doc1.setDocument("文本内容");
store.add(doc1);

// 批量添加
Document doc2 = new Document();
doc2.setId("2");
doc2.setDocument("文档 A");

Document doc3 = new Document();
doc3.setId("3");
doc3.setDocument("文档 B");

store.add(Arrays.asList(doc2, doc3));

// 删除文档
store.delete("1");  // 通过 ID 删除
```

### 语义搜索

```java
// 基础搜索
SearchRequest request = new SearchRequest();
request.setQuery("搜索关键词");

List<Document> results = store.similaritySearch(request);

// 遍历结果
for (Document doc : results) {
    System.out.println("ID: " + doc.getId());
    System.out.println("内容: " + doc.getDocument());
    System.out.println("元数据: " + doc.getMetadata());
}
```

### 元数据过滤

结合语义搜索和元数据过滤：

```java
import tech.smartboot.feat.ai.vector.expression.Expression;

// 创建过滤条件
Expression filter = Expression.of("category").eq("tech")
    .and(Expression.of("status").eq("published"));

SearchRequest request = new SearchRequest();
request.setQuery("Java 新特性");
request.setExpression(filter);
request.setTopK(5);

List<Document> results = store.similaritySearch(request);
```

### 数据库管理

```java
// 创建数据库
chroma.createDatabase("my_database");

// 获取数据库信息
String info = chroma.getDatabase("my_database");

// 删除数据库
chroma.deleteDatabase("my_database");
```

## 完整示例

```java
import tech.smartboot.feat.ai.FeatAI;
import tech.smartboot.feat.ai.vector.*;
import tech.smartboot.feat.ai.embedding.EmbeddingModelVendor;

public class ChromaExample {
    public static void main(String[] args) {
        // 1. 创建带嵌入模型的 Vector Store
        VectorStore store = VectorStore.chroma(opts -> opts
            .setUrl("http://localhost:8000")
            .embeddingModel(FeatAI.embedding(embedOpts ->
                embedOpts.model(EmbeddingModelVendor.GiteeAI.BGE_M3)
            ))
        );

        // 2. 添加知识文档
        Document doc1 = new Document();
        doc1.setId("1");
        doc1.setDocument("Feat AI 支持多种大语言模型，包括 DeepSeek、OpenAI 等");
        doc1.setMetadata(Map.of("type", "feature"));

        Document doc2 = new Document();
        doc2.setId("2");
        doc2.setDocument("Feat AI 提供 Agent 功能，可以自动完成复杂任务");
        doc2.setMetadata(Map.of("type", "feature"));

        Document doc3 = new Document();
        doc3.setId("3");
        doc3.setDocument("Feat AI 基于 Java 开发，支持异步编程模型");
        doc3.setMetadata(Map.of("type", "feature"));
        
        store.add(Arrays.asList(doc1, doc2, doc3));

        // 3. 语义搜索
        SearchRequest request = new SearchRequest();
        request.setQuery("Feat AI 支持哪些模型");

        List<Document> results = store.similaritySearch(request);
        
        System.out.println("搜索结果：");
        results.forEach(doc -> {
            System.out.println("- " + doc.getDocument());
            System.out.println("  元数据: " + doc.getMetadata());
        });
    }
}
```

## API 参考

### VectorStore

| 方法 | 说明 |
|------|------|
| `add(Document)` | 添加单个文档 |
| `add(List<Document>)` | 批量添加文档 |
| `delete(String)` | 删除指定 ID 的文档 |
| `similaritySearch(SearchRequest)` | 语义相似度搜索 |

### SearchRequest

| 方法 | 说明 |
|------|------|
| `setQuery(String)` | 搜索查询文本 |
| `setExpression(Expression)` | 元数据过滤条件 |

### ChromaVectorOptions

| 方法 | 说明 |
|------|------|
| `setUrl(String)` | Chroma 服务地址 |
| `embeddingModel(EmbeddingModel)` | 嵌入模型 |
| `debug(boolean)` | 启用调试日志 |

## 下一步

- **[Embedding](embedding.mdx)** - 了解更多关于文本嵌入的内容
- **[Agent](agent.mdx)** - 使用 Vector Store 构建 RAG 应用
