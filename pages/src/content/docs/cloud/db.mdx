---
title: 3.5 æ•°æ®åº“å¼€å‘ ğŸ”
description: ä¸€æ¬¾ä¼ä¸šçº§ Web æœåŠ¡å¼€å‘æ¡†æ¶
sidebar:
    order: 5
---
import {TabItem, Tabs,Aside} from "@astrojs/starlight/components";
import CheckAuthorize from '../../../components/CheckAuthorize.astro'

<CheckAuthorize/>


Feat Cloud å·²åŒ Mybatis åšäº†ä¸€å®šç¨‹åº¦çš„é›†æˆï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ Mybatis æä¾›çš„ Mapper æ¥å£æ¥è¿›è¡Œæ•°æ®åº“çš„æ“ä½œã€‚

## 3.5.1 é…ç½® mybatis-config.xml
åœ¨ `src/main/resources` ç›®å½•ä¸‹åˆ›å»º `mybatis-config.xml`ï¼Œ æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <plugins>
       ...
    </plugins>
    <environments default="mysql">
        <environment id="mysql">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="url" value="jdbc:mysql://localhost:3306/test?characterEncoding=utf-8"/>
                <property name="username" value="root"/>
                <property name="password" value="root"/>
            </dataSource>
        </environment>
    </environments>
    <mappers>
        <!-- æ‰«æmapperæ¥å£ -->
        <package name="org.smartboot.feat.demo.dao.mapper"/>
    </mappers>
</configuration>
```
è¯¥æ–‡ä»¶å¯ä»¥å¯ä»¥æ”¾ç½®åœ¨ä»»æ„å­ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ `src/main/resources/mybatis/mybatis-config.xml`ã€‚

## 3.5.2 å®ä¾‹åŒ– SqlSessionFactory
æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ä¾‹åŒ– SqlSessionFactoryï¼Œç¬¬ä¸€ç§æ˜¯åœ¨ Bean æˆ–è€… Controller å®ä¾‹ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› SqlSessionFactory å¯¹è±¡ã€‚

<Tabs>
    <TabItem label="@Bean">
    ```
    @Bean
    public class MybatisSessionFactory {

        @Bean("sessionFactory")
        public SqlSessionFactory sessionFactory() throws IOException {
            return new SqlSessionFactoryBuilder().build(Resources.getResourceAsStream("mybatis/mybatis-config.xml"));
        }
    }
    ```
    </TabItem>

    <TabItem label="@Controller">
    ```
    @Controller
    public class ControllerDemo {

        @Bean("sessionFactory")
        public SqlSessionFactory sessionFactory() throws IOException {
            return new SqlSessionFactoryBuilder().build(Resources.getResourceAsStream("mybatis/mybatis-config.xml"));
        }
    }
    ```
    </TabItem>
</Tabs>

<Aside>
   ç”Ÿæˆçš„ SqlSessionFactory å¯¹è±¡ bean åç§°å¿…é¡»ä¸º **sessionFactory**ã€‚
</Aside>

## 3.5.3 å®šä¹‰@Mapperæ¥å£
@Mapper çš„ä½¿ç”¨æ–¹å¼åŒ Spring åŸºæœ¬ä¸€è‡´ï¼Œä¾‹å¦‚ï¼š
```java title="UserMapper.java"
@Mapper
public interface UserMapper {

    @Select({"<script>",
            "select * from user_info ",
            "WHERE 1=1",
            "order by username",
            "</script>"})
    @ResultType(UserDO.class)
    List<UserDO> getUserList(UserQuery query);

    @Select("select * from user_info where username=#{username} and password=#{password}")
    @ResultType(UserDO.class)
    UserDO getUser(@Param("username") String username, @Param("password") String password);

    /**
     * æ–°å¢è®¢é˜…è®°å½•
     */
    @Insert("insert into user_info(username,password,role,`desc`) values(#{username},#{password},#{role},#{desc})")
    void insert(UserDO userDO);

    @Delete("<script>delete from user_info where username in" +
            "   <foreach collection='users' item='username' index='index'" +
            "          open='(' close=')' separator=','>" +
            "      #{username}" +
            "   </foreach> " +
            "</script>")
    int deleteUsers(@Param("users") List<String> usernames);
}
```

## 3.5.4 ä½¿ç”¨ @Mapper
Mapper æ¥å£çš„ä½¿ç”¨æ–¹å¼åŒæ™®é€š Bean ä¸€è‡´ï¼Œé€šè¿‡ `@Autowired` æ³¨è§£æ³¨å…¥å³å¯ã€‚
```java title="ControllerDemo.java"
@Controller
public class ControllerDemo {

    @Autowired
    private UserMapper userMapper;

    @RequestMapping("/user")
    public String user() {
        UserDO userDO = userMapper.getUser("admin", "123456");
        System.out.println(userDO);
        return "success";
    }
}
```