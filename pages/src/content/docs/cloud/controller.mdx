---
title: 3.4 Controller å¼€å‘ ğŸ”
description: ä¸€æ¬¾ä¼ä¸šçº§ Web æœåŠ¡å¼€å‘æ¡†æ¶
sidebar:
    order: 4
---
import CheckAuthorize from '../../../components/CheckAuthorize.astro'
import {TabItem, Tabs, Aside} from "@astrojs/starlight/components";

<CheckAuthorize/>

# Controller å¼€å‘

## 3.4.1 Feat Cloud ä¸ Spring Boot çš„å¯¹æ¯”

Feat Cloud å’Œ Spring Boot éƒ½æä¾›äº†ä¾¿æ·çš„ Web å¼€å‘ä½“éªŒï¼Œä½†åœ¨ Controller çš„å®ç°æ–¹å¼ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚ä¸‹é¢æˆ‘ä»¬å¯¹æ¯”ä¸¤è€…çš„ä¸»è¦å·®å¼‚ï¼š

| ç‰¹æ€§ | Feat Cloud | Spring Boot |
| --- | --- | --- |
| æ³¨è§£å®šä¹‰ | `@Controller`ã€`@RequestMapping` | `@Controller`ã€`@RestController`ã€`@RequestMapping` |
| è·¯ç”±æ˜ å°„ | åŸºäºæ–¹æ³•çš„ `@RequestMapping` | æ”¯æŒ `@GetMapping`ã€`@PostMapping` ç­‰ HTTP æ–¹æ³•ç‰¹å®šæ³¨è§£ |
| å‚æ•°å¤„ç† | è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œæ”¯æŒ HttpRequestã€HttpResponse ç­‰åŸç”Ÿå¯¹è±¡ | ä½¿ç”¨ `@RequestParam`ã€`@PathVariable`ã€`@RequestBody` ç­‰æ³¨è§£ |
| å¼‚æ­¥å¤„ç† | é€šè¿‡ `@Controller(async=true)` é…ç½® | ä½¿ç”¨ `@Async` æˆ–è¿”å› `CompletableFuture`ã€`DeferredResult` |
| ä¾èµ–æ³¨å…¥ | æ”¯æŒæ„é€ å™¨æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ | æ”¯æŒæ„é€ å™¨æ³¨å…¥ã€å­—æ®µæ³¨å…¥å’Œ setter æ³¨å…¥ |
| ç¼–è¯‘æ—¶å¤„ç† | ç¼–è¯‘æ—¶é™æ€è½¬ç ï¼Œæ— è¿è¡Œæ—¶åå°„ | è¿è¡Œæ—¶åå°„å’ŒåŠ¨æ€ä»£ç† |

<Aside type="note">
  Feat Cloud çš„ Controller åœ¨ç¼–è¯‘æ—¶å®Œæˆé™æ€è½¬ç ï¼Œç›¸æ¯” Spring Boot çš„è¿è¡Œæ—¶åå°„æœºåˆ¶ï¼Œå…·æœ‰æ›´é«˜çš„æ€§èƒ½ä¼˜åŠ¿ã€‚
</Aside>

## 3.4.2 Controller åŸºæœ¬ä½¿ç”¨

### 3.4.2.1 å®šä¹‰ Controller

åœ¨ Feat Cloud ä¸­ï¼Œä½¿ç”¨ `@Controller` æ³¨è§£æ ‡è®°ä¸€ä¸ªç±»ä¸ºæ§åˆ¶å™¨ï¼š

```java
import tech.smartboot.feat.cloud.annotation.Controller;
import tech.smartboot.feat.cloud.annotation.RequestMapping;

@Controller
public class HelloController {
    
    @RequestMapping("/hello")
    public String hello() {
        return "Hello, Feat Cloud!";
    }
}
```

### 3.4.2.2 è¯·æ±‚æ˜ å°„

ä½¿ç”¨ `@RequestMapping` æ³¨è§£å°† HTTP è¯·æ±‚æ˜ å°„åˆ°æ§åˆ¶å™¨çš„æ–¹æ³•ï¼š

```java
@Controller
public class UserController {
    
    @RequestMapping("/users")
    public List<User> getUsers() {
        // è¿”å›ç”¨æˆ·åˆ—è¡¨
        return userService.findAll();
    }
    
    @RequestMapping("/users/{id}")
    public User getUser(String id) {
        // æ ¹æ®IDè¿”å›ç”¨æˆ·
        return userService.findById(id);
    }
}
```

## 3.4.3 è¯·æ±‚å¤„ç†

### 3.4.3.1 å‚æ•°ç»‘å®š

Feat Cloud æ”¯æŒå¤šç§å‚æ•°ç±»å‹çš„è‡ªåŠ¨ç»‘å®šï¼š

```java
@Controller
public class OrderController {
    
    // åŸºæœ¬ç±»å‹å‚æ•°è‡ªåŠ¨ç»‘å®š
    @RequestMapping("/orders")
    public List<Order> getOrders(int page, int size) {
        return orderService.findByPage(page, size);
    }
    
    // å¯¹è±¡å‚æ•°è‡ªåŠ¨ç»‘å®š
    @RequestMapping("/orders/create")
    public Order createOrder(Order order) {
        return orderService.create(order);
    }
    
    // åŸç”Ÿè¯·æ±‚/å“åº”å¯¹è±¡
    @RequestMapping("/orders/download")
    public void downloadOrders(HttpRequest request, HttpResponse response) {
        // å¤„ç†æ–‡ä»¶ä¸‹è½½
        response.setContentType(HeaderValue.ContentType.APPLICATION_OCTET_STREAM);
        // ...
    }
}
```

### 3.4.3.2 å®é™…æ¡ˆä¾‹åˆ†æ

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®é™…çš„ Controller ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å¤„ç†ä¸åŒç±»å‹çš„è¯·æ±‚å’Œå“åº”ï¼š

<Tabs>
    <TabItem label="FeatController.java">
    ```java
    @Controller
    public class FeatController {
        static byte[] body = "Hello, World!".getBytes();

        @RequestMapping("/plaintext")
        public byte[] plaintext(HttpResponse response) {
            response.setContentType(HeaderValue.ContentType.TEXT_PLAIN_UTF8);
            return body;
        }

        @RequestMapping("/json")
        public Message json(HttpResponse response) {
            response.setContentType(HeaderValue.ContentType.APPLICATION_JSON_UTF8);
            return new Message("Hello, World!");
        }
    }
    ```
    </TabItem>
    <TabItem label="Message.java">
    ```java
    public class Message {
        private String message;

        public Message(String message) {
            this.message = message;
        }

        public String getMessage() {
            return message;
        }

        public void setMessage(String message) {
            this.message = message;
        }
    }
    ```
    </TabItem>
</Tabs>

## 3.4.4 é«˜çº§ç‰¹æ€§

### 3.4.4.1 å¼‚æ­¥å¤„ç†

Feat Cloud æ”¯æŒå¼‚æ­¥ Controllerï¼Œé€šè¿‡è®¾ç½® `@Controller` çš„ `async` å±æ€§ä¸º `true` å¯ç”¨ï¼š

```java
@Controller(async = true)
public class AsyncController {
    
    @RequestMapping("/async/data")
    public CompletableFuture<Data> getAsyncData() {
        return CompletableFuture.supplyAsync(() -> {
            // æ‰§è¡Œè€—æ—¶æ“ä½œ
            return new Data("Async result");
        });
    }
}
```

### 3.4.4.2 è·¨åŸŸæ”¯æŒ

ä½¿ç”¨ `@CrossOrigin` æ³¨è§£æ”¯æŒè·¨åŸŸè¯·æ±‚ï¼š

```java
@Controller
public class ApiController {
    
    @CrossOrigin
    @RequestMapping("/api/data")
    public Data getData() {
        return new Data("Cross-origin data");
    }
}
```

### 3.4.4.3 ä¾èµ–æ³¨å…¥

Feat Cloud æ”¯æŒåœ¨ Controller ä¸­æ³¨å…¥å…¶ä»–æœåŠ¡ï¼š

```java
@Controller
public class ProductController {
    
    private final ProductService productService;
    
    // æ„é€ å™¨æ³¨å…¥
    public ProductController(ProductService productService) {
        this.productService = productService;
    }
    
    @RequestMapping("/products")
    public List<Product> getProducts() {
        return productService.findAll();
    }
}
```

## 3.4.5 æœ€ä½³å®è·µ

### 3.4.5.1 Controller è®¾è®¡åŸåˆ™

1. **èŒè´£å•ä¸€**ï¼šController åªè´Ÿè´£è¯·æ±‚çš„æ¥æ”¶å’Œå“åº”çš„è¿”å›ï¼Œä¸šåŠ¡é€»è¾‘åº”å½“æ”¾åœ¨ Service å±‚ã€‚
2. **å‚æ•°æ ¡éªŒ**ï¼šå¯¹è¾“å…¥å‚æ•°è¿›è¡Œå¿…è¦çš„æ ¡éªŒï¼Œç¡®ä¿æ•°æ®çš„åˆæ³•æ€§ã€‚
3. **å¼‚å¸¸å¤„ç†**ï¼šåˆç†å¤„ç†å¼‚å¸¸ï¼Œé¿å…å°†å¼‚å¸¸ç›´æ¥æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚
4. **RESTful è®¾è®¡**ï¼šéµå¾ª RESTful API è®¾è®¡è§„èŒƒï¼Œä½¿ API æ›´åŠ ç›´è§‚å’Œæ˜“ç”¨ã€‚

### 3.4.5.2 æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨å¼‚æ­¥å¤„ç†**ï¼šå¯¹äºè€—æ—¶æ“ä½œï¼Œè€ƒè™‘ä½¿ç”¨å¼‚æ­¥ Controllerã€‚
2. **åˆç†è®¾ç½®å“åº”ç±»å‹**ï¼šæ ¹æ®å®é™…éœ€æ±‚è®¾ç½®åˆé€‚çš„ Content-Typeã€‚
3. **é¿å…å¤§å¯¹è±¡ä¼ è¾“**ï¼šå¯¹äºå¤§æ•°æ®é‡çš„å“åº”ï¼Œè€ƒè™‘åˆ†é¡µæˆ–æµå¼å¤„ç†ã€‚

<Aside type="tip">
  Feat Cloud çš„ Controller åœ¨ç¼–è¯‘æ—¶å®Œæˆé™æ€è½¬ç ï¼Œæ— éœ€è¿è¡Œæ—¶åå°„ï¼Œå› æ­¤å…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¿™ä¸€ä¼˜åŠ¿å°¤ä¸ºæ˜æ˜¾ã€‚
</Aside>
