---
title: AOT ç¼–è¯‘å’Œ AOT è™šæ‹Ÿæœº
description: æ·±åº¦è§£æFeatæ¡†æ¶AOTç¼–è¯‘æœºåˆ¶å’ŒAOTè™šæ‹Ÿæœºæ¨¡å¼çš„æ ¸å¿ƒåŸç†
sidebar:
    order: 2
---

import CheckAuthorize from '../../../components/CheckAuthorize.astro'
import Mermaid from '../../../components/Mermaid.astro'
import { TabItem, Tabs, Aside } from "@astrojs/starlight/components";

<CheckAuthorize/>

## æŠ€æœ¯èƒŒæ™¯

Featæ¡†æ¶ä½œä¸ºé«˜æ€§èƒ½Java Webå¼€å‘æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒç«äº‰åŠ›åœ¨äºé€šè¿‡AOTï¼ˆAhead-of-Timeï¼‰ç¼–è¯‘æŠ€æœ¯å®ç°é›¶åå°„çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ç›¸æ¯”ä¼ ç»ŸJavaæ¡†æ¶åœ¨è¿è¡Œæ—¶çš„åå°„æ“ä½œï¼ŒFeatåœ¨ç¼–è¯‘æœŸå°±å®Œæˆäº†æ‰€æœ‰çš„ä»£ç ç”Ÿæˆå’Œä¼˜åŒ–å·¥ä½œã€‚

### ä¼ ç»Ÿæ¡†æ¶çš„ç—›ç‚¹

| é—®é¢˜ | Spring Boot | Vert.x | Feat Cloud |
|------|-------------|--------|-------------|
| **å¯åŠ¨æ—¶é—´** | 3-10ç§’ | 1-3ç§’ | &lt;100ms |
| **å†…å­˜å ç”¨** | 200-500MB | 100-200MB | 50-100MB |
| **åå°„å¼€é”€** | é«˜ | ä½ | æ—  |
| **å¼€å‘ä½“éªŒ** | ä¼˜ç§€ | ä¸€èˆ¬ | ä¼˜ç§€ |
| **GraalVMæ”¯æŒ** | å¤æ‚ | ä¸­ç­‰ | åŸç”Ÿæ”¯æŒ |

### æŠ€æœ¯åˆ›æ–°ç‚¹

ğŸ’¡ **ç¼–è¯‘æœŸä»£ç ç”Ÿæˆ**ï¼šé€šè¿‡APTæŠ€æœ¯åœ¨ç¼–è¯‘æœŸåˆ†ææ³¨è§£å¹¶ç”Ÿæˆä¼˜åŒ–ä»£ç 
ğŸ’¡ **åŒæ¨¡å¼æ¶æ„**ï¼šæ”¯æŒAOTå’ŒAOT VMä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œå…¼é¡¾æ€§èƒ½å’Œå¼€å‘æ•ˆç‡
ğŸ’¡ **é›¶é…ç½®åŠ è½½**ï¼šåŸºäºSPIæœºåˆ¶å®ç°çš„æœåŠ¡è‡ªåŠ¨å‘ç°å’ŒåŠ è½½

## æ¶æ„æ¦‚è§ˆ

Featæ¡†æ¶æä¾›äº†ä¸¤ç§è¿è¡Œæ¨¡å¼æ¥æ»¡è¶³ä¸åŒå¼€å‘é˜¶æ®µçš„éœ€æ±‚ï¼š

<Mermaid code={`
graph TD
    A[Featåº”ç”¨å¯åŠ¨] --> B{è¿è¡Œæ¨¡å¼é€‰æ‹©}
    B --> C[AOTæ¨¡å¼]
    B --> D[AOT VMæ¨¡å¼] 
    
    C --> C1[ç¼–è¯‘æœŸä»£ç ç”Ÿæˆ]
    C1 --> C2[é™æ€ç±»åŠ è½½]
    C2 --> C3[é«˜æ€§èƒ½è¿è¡Œ]
    
    D --> D1[è¿è¡Œæ—¶åå°„æ‰«æ]
    D1 --> D2[åŠ¨æ€ä»£ç†]
    D2 --> D3[å…¼å®¹æ€§è¿è¡Œ]
`} />

### æ¨¡å¼å¯¹æ¯”åˆ†æ

| ç‰¹æ€§ | AOTæ¨¡å¼ | AOT VMæ¨¡å¼ |
|------|---------|------------|
| **ç¼–è¯‘æœŸä¼˜åŒ–** | âœ… å®Œå…¨é™æ€ç”Ÿæˆ | âŒ è¿è¡Œæ—¶å¤„ç† |
| **å¯åŠ¨æ€§èƒ½** | ğŸš€ æå¿«ï¼ˆ\<100msï¼‰ | âš¡ ä¸­ç­‰ |
| **è¿è¡Œæ€§èƒ½** | ğŸš€ æœ€ä¼˜ | âš¡ è‰¯å¥½ |
| **å†…å­˜å ç”¨** | ğŸ“‰ æœ€ä½ | ğŸ“Š ä¸­ç­‰ |
| **å¼€å‘ä½“éªŒ** | ğŸ”§ éœ€é‡ç¼–è¯‘ | ğŸ”„ çƒ­é‡è½½ |
| **è°ƒè¯•å‹å¥½** | âŒ é—´æ¥è°ƒè¯• | âœ… ç›´æ¥è°ƒè¯• |
| **é€‚ç”¨åœºæ™¯** | ğŸ­ ç”Ÿäº§ç¯å¢ƒ | ğŸ§ª å¼€å‘æµ‹è¯• |

## AOTç¼–è¯‘åŸç†æ·±åº¦è§£æ

### 1. æ³¨è§£å¤„ç†å™¨æ·±åº¦åˆ†æ

AOTç¼–è¯‘çš„æ ¸å¿ƒæ˜¯`FeatAnnotationProcessor`ï¼Œå®ƒåŸºäºJava APTï¼ˆAnnotation Processing Toolï¼‰æŠ€æœ¯åœ¨ç¼–è¯‘æœŸæ‰«æå’Œå¤„ç†æ³¨è§£ï¼š

<Mermaid code={`
sequenceDiagram
    participant Compiler as Javaç¼–è¯‘å™¨
    participant Processor as FeatAnnotationProcessor
    participant Scanner as æ³¨è§£æ‰«æå™¨
    participant Generator as ä»£ç ç”Ÿæˆå™¨
    participant File as ç›®æ ‡æ–‡ä»¶
    
    Compiler->>Processor: è°ƒç”¨processæ–¹æ³•
    Processor->>Scanner: æ‰«æ@Controllerã€@Beanç­‰æ³¨è§£
    Scanner->>Processor: è¿”å›æ³¨è§£å…ƒç´ åˆ—è¡¨
    
    loop å¤„ç†æ¯ä¸ªæ³¨è§£å…ƒç´ 
        Processor->>Generator: åˆ›å»ºå¯¹åº”Serializer
        Generator->>Generator: ç”ŸæˆJavaä»£ç 
        Generator->>File: å†™å…¥.javaæ–‡ä»¶
    end
    
    Processor->>File: ç”ŸæˆSPIé…ç½®æ–‡ä»¶
    Processor->>Compiler: ç¼–è¯‘å®Œæˆ
`} />

#### APTæŠ€æœ¯æ·±åº¦è§£æ

APTåœ¨Javaç¼–è¯‘è¿‡ç¨‹ä¸­æ’å…¥äº†ä¸€ä¸ªé¢å¤–çš„å¤„ç†é˜¶æ®µï¼š

1. **ç¼–è¯‘æœŸæ‰«æ**ï¼šéµå¾ª`javax.annotation.processing.Processor`æ¥å£è§„èŒƒ
2. **å…ƒæ•°æ®åˆ†æ**ï¼šé€šè¿‡`Element` APIè·å–ç±»ã€æ–¹æ³•ã€å­—æ®µçš„å…ƒä¿¡æ¯
3. **ä»£ç ç”Ÿæˆ**ï¼šä½¿ç”¨`Filer` APIåˆ›å»ºæ–°çš„Javaæºæ–‡ä»¶
4. **å¾ªç¯å¤„ç†**ï¼šæ”¯æŒå¤šè½®å¤„ç†ï¼Œç›´åˆ°æ²¡æœ‰æ–°çš„æ³¨è§£éœ€è¦å¤„ç†

#### æ”¯æŒçš„æ³¨è§£ç±»å‹åŠå¤„ç†ç­–ç•¥

```java
@Override
public Set<String> getSupportedAnnotationTypes() {
    Set<String> types = new HashSet<>();
    types.add(Bean.class.getCanonicalName());        // Beanç®¡ç†
    types.add(Autowired.class.getCanonicalName());   // ä¾èµ–æ³¨å…¥
    types.add(Controller.class.getCanonicalName());  // Webæ§åˆ¶å™¨
    types.add(Mapper.class.getCanonicalName());      // æ•°æ®è®¿é—®å±‚
    types.add(McpEndpoint.class.getCanonicalName()); // MCPåè®®ç«¯ç‚¹
    return types;
}

@Override
public Set<String> getSupportedOptions() {
    return Set.of(
        "feat.debug",           // å¼€å¯è°ƒè¯•æ¨¡å¼
        "feat.package.scan",    // æŒ‡å®šæ‰«æåŒ…è·¯å¾„
        "feat.optimization"     // ä¼˜åŒ–çº§åˆ«
    );
}
```

### 2. ä»£ç ç”Ÿæˆåºåˆ—åŒ–å™¨æ¶æ„è®¾è®¡

Featé‡‡ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼è®¾è®¡äº†åºåˆ—åŒ–å™¨ä½“ç³»ï¼Œæ¯ç§æ³¨è§£å¯¹åº”ä¸€ä¸ªä¸“é—¨çš„åºåˆ—åŒ–å™¨ï¼š

<Mermaid code={`
classDiagram
    class Serializer {
        +serializeImport()
        +serializeProperty()
        +serializeLoadBean()
        +serializeAutowired()
        +serializeRouter()
        +serializeDestroy()
        +order() int
    }
    
    class AbstractSerializer {
        -PrintWriter printWriter
        -String packageName
        -String className
        -Map~String,Object~ context
        +getPrintWriter()
        +packageName()
        +className()
        +addContext(String, Object)
        #generateImports()
        #generateFields()
    }
    
    class ControllerSerializer {
        +serializeRouter()
        +serializeLoadBean()
        +order() 100
        -generateRouteMapping()
        -generateParameterParsing()
        -generateResponseSerialization()
    }
    
    class BeanSerializer {
        +serializeLoadBean()
        +serializeAutowired()
        +order() 200
        -generateBeanFactory()
        -generateDependencyInjection()
    }
    
    class MapperSerializer {
        +serializeLoadBean()
        +order() 300
        -generateMyBatisProxy()
        -generateSqlMapping()
    }
    
    class McpEndpointSerializer {
        +serializeRouter()
        +serializeLoadBean() 
        +order() 400
        -generateMcpTools()
        -generateMcpPrompts()
        -generateMcpResources()
    }
    
    Serializer <|-- AbstractSerializer
    AbstractSerializer <|-- ControllerSerializer
    AbstractSerializer <|-- BeanSerializer
    AbstractSerializer <|-- MapperSerializer
    AbstractSerializer <|-- McpEndpointSerializer
`} />

#### é«˜çº§ä¼˜åŒ–ç­–ç•¥

1. **æ­»ä»£ç æ¶ˆé™¤**ï¼šåˆ†æä¾èµ–å…³ç³»ï¼Œåªç”Ÿæˆå®é™…ä½¿ç”¨çš„ä»£ç 
2. **å†…è”ä¼˜åŒ–**ï¼šå°†ç®€å•çš„æ–¹æ³•è°ƒç”¨ç›´æ¥å†…è”åˆ°ç”Ÿæˆä»£ç ä¸­
3. **å¸¸é‡æŠ˜å **ï¼šåœ¨ç¼–è¯‘æœŸè®¡ç®—å¸¸é‡è¡¨è¾¾å¼
4. **ç±»å‹ç‰¹åŒ–**ï¼šé’ˆå¯¹å…·ä½“ç±»å‹ç”Ÿæˆä¼˜åŒ–çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ä»£ç 

```java
// ç¤ºä¾‹ï¼šç±»å‹ç‰¹åŒ–çš„JSONåºåˆ—åŒ–
public void generateTypeSpecificSerialization(TypeElement typeElement) {
    // åˆ†æå­—æ®µç±»å‹ï¼Œç”Ÿæˆç‰¹åŒ–çš„åºåˆ—åŒ–ä»£ç 
    for (VariableElement field : ElementFilter.fieldsIn(typeElement.getEnclosedElements())) {
        TypeMirror fieldType = field.asType();
        if (isStringType(fieldType)) {
            writer.println("builder.append('\"').append(" + field.getSimpleName() + ").append('\"');");
        } else if (isNumericType(fieldType)) {
            writer.println("builder.append(" + field.getSimpleName() + ");");
        }
        // ... å…¶ä»–ç±»å‹å¤„ç†
    }
}
```

### 3. ç¼–è¯‘æœŸä»£ç è½¬æ¢æ·±åº¦åˆ†æ

ä»¥ä¸€ä¸ªå¤æ‚çš„Controllerä¸ºä¾‹ï¼Œå±•ç¤ºAOTç¼–è¯‘çš„æ·±åº¦ä»£ç è½¬æ¢è¿‡ç¨‹ï¼š

<Tabs>
    <TabItem label="æºä»£ç ">
        ```java title="UserController.java"
        @Controller("api")
        public class UserController {
            @Autowired
            private UserService userService;
            
            @Autowired  
            private ValidationService validationService;
            
            @RequestMapping("/users/:id")
            public User getUser(@PathParam("id") Long id) {
                validationService.validateId(id);
                return userService.getUserById(id);
            }
            
            @RequestMapping(value = "/users", method = RequestMethod.POST)
            public RestResult<User> createUser(@Param("user") User user) {
                validationService.validateUser(user);
                User created = userService.createUser(user);
                return RestResult.success(created);
            }
            
            @PostConstruct
            public void init() {
                System.out.println("UserController initialized");
            }
            
            @PreDestroy
            public void cleanup() {
                System.out.println("UserController cleanup");
            }
        }
        ```
    </TabItem>
    
    <TabItem label="ç”Ÿæˆä»£ç ">
        ```java title="UserControllerCloudService.java"
        public class UserControllerCloudService extends AbstractCloudService {
            private UserController bean;
            private UserService userService;
            private ValidationService validationService;
            
            @Override
            public int order() {
                return 100; // Controllerä¼˜å…ˆçº§
            }
            
            public void loadBean(ApplicationContext applicationContext) throws Throwable {
                bean = new UserController();
            }
            
            public void autowired(ApplicationContext applicationContext) throws Throwable {
                // ç›´æ¥è°ƒç”¨setteræ–¹æ³•ï¼Œé¿å…åå°„
                userService = applicationContext.getBean("userService", UserService.class);
                validationService = applicationContext.getBean("validationService", ValidationService.class);
                
                // ä¼˜å…ˆä½¿ç”¨setteræ–¹æ³•
                if (hasSetterMethod("setUserService", UserService.class)) {
                    bean.setUserService(userService);
                } else {
                    // ç›´æ¥å­—æ®µèµ‹å€¼
                    setField(bean, "userService", userService);
                }
                
                if (hasSetterMethod("setValidationService", ValidationService.class)) {
                    bean.setValidationService(validationService);
                } else {
                    setField(bean, "validationService", validationService);
                }
            }
            
            public void postConstruct(ApplicationContext applicationContext) throws Throwable {
                bean.init();
            }
            
            public void router(ApplicationContext applicationContext, Router router) {
                // GET /api/users/:id - ç±»å‹å®‰å…¨çš„å‚æ•°è§£æ
                router.route("/api/users/:id", ctx -> {
                    try {
                        Long id = Long.valueOf(ctx.pathParam("id"));
                        User result = bean.getUser(id);
                        
                        // ç±»å‹ç‰¹åŒ–çš„JSONåºåˆ—åŒ–
                        String json = serializeUser(result);
                        byte[] bytes = json.getBytes(StandardCharsets.UTF_8);
                        
                        ctx.Response.setContentType("application/json; charset=utf-8");
                        ctx.Response.setContentLength(bytes.length);
                        ctx.Response.write(bytes);
                    } catch (NumberFormatException e) {
                        handleBadRequest(ctx, "Invalid user ID format");
                    } catch (Exception e) {
                        handleInternalError(ctx, e);
                    }
                });
                
                // POST /api/users - å¤æ‚å¯¹è±¡ååºåˆ—åŒ–
                router.route("/api/users", HttpMethod.POST, ctx -> {
                    try {
                        User user = deserializeUser(ctx.Request.getBody());
                        RestResult<User> result = bean.createUser(user);
                        
                        String json = serializeRestResult(result);
                        byte[] bytes = json.getBytes(StandardCharsets.UTF_8);
                        
                        ctx.Response.setContentType("application/json; charset=utf-8");
                        ctx.Response.setContentLength(bytes.length);
                        ctx.Response.write(bytes);
                    } catch (JsonParseException e) {
                        handleBadRequest(ctx, "Invalid JSON format");
                    } catch (Exception e) {
                        handleInternalError(ctx, e);
                    }
                });
            }
            
            public void destroy() throws Throwable {
                if (bean != null) {
                    bean.cleanup();
                }
            }
            
            // ç¼–è¯‘æœŸç”Ÿæˆçš„ç±»å‹ç‰¹åŒ–åºåˆ—åŒ–æ–¹æ³•
            private String serializeUser(User user) {
                if (user == null) return "null";
                StringBuilder sb = new StringBuilder(128);
                sb.append('{');
                sb.append('\"').append("id").append('\"').append(':').append(user.getId()).append(',');
                sb.append('\"').append("name").append('\"').append(':').append('\"').append(escapeJson(user.getName())).append('\"').append(',');
                sb.append('\"').append("email").append('\"').append(':').append('\"').append(escapeJson(user.getEmail())).append('\"');
                sb.append('}');
                return sb.toString();
            }
            
            private User deserializeUser(byte[] body) {
                // ç¼–è¯‘æœŸç”Ÿæˆçš„é«˜æ€§èƒ½ååºåˆ—åŒ–ä»£ç 
                // é¿å…ä½¿ç”¨åå°„å’ŒJSONè§£æå™¨
                // ... å…·ä½“å®ç°
            }
        }
        ```
    </TabItem>
</Tabs>

#### æ·±åº¦ä¼˜åŒ–ç‰¹æ€§

1. **é›¶åå°„ä¾èµ–æ³¨å…¥**ï¼šç›´æ¥ç”Ÿæˆsetterè°ƒç”¨æˆ–å­—æ®µèµ‹å€¼ä»£ç 
2. **ç±»å‹å®‰å…¨çš„å‚æ•°è§£æ**ï¼šç¼–è¯‘æœŸç¡®å®šå‚æ•°ç±»å‹ï¼Œç”Ÿæˆä¸“ç”¨è§£æä»£ç 
3. **å†…è”JSONåºåˆ—åŒ–**ï¼šé’ˆå¯¹å…·ä½“ç±»å‹ç”Ÿæˆä¼˜åŒ–çš„åºåˆ—åŒ–ä»£ç 
4. **å¼‚å¸¸å¤„ç†ä¼˜åŒ–**ï¼šé¢„ç”Ÿæˆå¸¸è§å¼‚å¸¸çš„å¤„ç†é€»è¾‘
5. **å†…å­˜å¸ƒå±€ä¼˜åŒ–**ï¼šæŒ‰ç…§è®¿é—®é¢‘ç‡ä¼˜åŒ–å­—æ®µæ’åˆ—

### 4. SPIæœåŠ¡å‘ç°æœºåˆ¶

ç”Ÿæˆçš„æœåŠ¡ç±»é€šè¿‡Java SPIæœºåˆ¶è¿›è¡ŒåŠ è½½ï¼Œç¡®ä¿åœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè¢«æ¡†æ¶æ­£ç¡®å‘ç°ï¼š

<Mermaid code={`
graph LR
    A[ç¼–è¯‘æœŸ] --> B[ç”ŸæˆCloudServiceå®ç°]
    B --> C[åˆ›å»ºSPIé…ç½®æ–‡ä»¶]
    C --> D[META-INF/services/CloudService]
    
    E[è¿è¡ŒæœŸ] --> F[ServiceLoader.load]
    F --> G[åŠ è½½æ‰€æœ‰CloudService]
    G --> H[æŒ‰orderæ’åº]
    H --> I[ä¾æ¬¡æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ]
`} />

## AOTè™šæ‹Ÿæœºæ¨¡å¼æ·±åº¦è§£æ

### 1. è®¾è®¡ç†å¿µ

AOT VMæ¨¡å¼æ˜¯ä¸ºå¼€å‘é˜¶æ®µè®¾è®¡çš„"ä¼ªAOT"è¿è¡Œç¯å¢ƒã€‚å®ƒåœ¨è¿è¡Œæ—¶æ¨¡æ‹ŸAOTç¼–è¯‘çš„è¡Œä¸ºï¼Œæä¾›ä¸AOTæ¨¡å¼å®Œå…¨ä¸€è‡´çš„APIä½“éªŒï¼ŒåŒæ—¶ä¿æŒå¼€å‘é˜¶æ®µçš„çµæ´»æ€§ã€‚

### 2. æ ¸å¿ƒå®ç°æœºåˆ¶

<Mermaid code={`
flowchart TD
    A[AotVMCloudServiceå¯åŠ¨] --> B[æ‰«æç±»è·¯å¾„]
    B --> C{å‘ç°æ³¨è§£ç±»?}
    C -->|"@Controller"| D[åˆ›å»ºControllerå®ä¾‹]
    C -->|"@Bean"| E[åˆ›å»ºBeanå®ä¾‹]
    C -->|"@Mapper"| F[åˆ›å»ºMapperä»£ç†]
    C -->|"@McpEndpoint"| G[åˆ›å»ºMCPæœåŠ¡]
    
    D --> H[åå°„è§£ææ–¹æ³•]
    E --> H
    F --> I[MyBatisåŠ¨æ€ä»£ç†]
    G --> J[MCPæœåŠ¡é…ç½®]
    
    H --> K[åŠ¨æ€è·¯ç”±æ³¨å†Œ]
    I --> L[æ•°æ®åº“æ“ä½œä»£ç†]
    J --> M[MCPåè®®æ”¯æŒ]
    
    K --> N[è¿è¡Œæ—¶è¯·æ±‚å¤„ç†]
    L --> N
    M --> N
`} />

### 3. åå°„æ‰«æä¸ç±»åŠ è½½

AOT VMæ¨¡å¼å®ç°äº†å®Œæ•´çš„ç±»è·¯å¾„æ‰«ææœºåˆ¶ï¼Œæ”¯æŒJARåŒ…å’Œç›®å½•ä¸¤ç§åŠ è½½æ–¹å¼ï¼š

```java
private List<Class> scanBean(List<Class> annotations) {
    List<Class> classes = new ArrayList<>();
    String packagePath = "./";
    
    Enumeration<URL> resources = Thread.currentThread()
        .getContextClassLoader().getResources(packagePath);
        
    while (resources.hasMoreElements()) {
        URL resource = resources.nextElement();
        if (resource.getProtocol().equals("file")) {
            // æ‰«ææ–‡ä»¶ç³»ç»Ÿä¸­çš„ç±»
            scanClassesInDirectory("", new File(resource.getFile()), classes, annotations);
        } else if (resource.getProtocol().equals("jar")) {
            // æ‰«æJARåŒ…ä¸­çš„ç±»
            scanClassesInJar(resource, "", classes, annotations);
        }
    }
    return classes;
}
```

### 4. åŠ¨æ€ä»£ç†ä¸è¯·æ±‚å¤„ç†

AOT VMæ¨¡å¼é€šè¿‡åå°„æœºåˆ¶å®ç°äº†å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹ï¼š

<Mermaid code={`
sequenceDiagram
    participant Client as HTTPå®¢æˆ·ç«¯
    participant Router as è·¯ç”±å™¨
    participant VM as AOT VM
    participant Controller as Controllerå®ä¾‹
    participant Method as ç›®æ ‡æ–¹æ³•
    
    Client->>Router: HTTPè¯·æ±‚
    Router->>VM: åŒ¹é…è·¯ç”±å¤„ç†å™¨
    VM->>VM: è§£ææ–¹æ³•å‚æ•°
    VM->>Controller: åå°„è°ƒç”¨æ–¹æ³•
    Controller->>Method: æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    Method->>Controller: è¿”å›ç»“æœ
    Controller->>VM: æ–¹æ³•è¿”å›å€¼
    VM->>VM: åºåˆ—åŒ–å“åº”
    VM->>Router: è¿”å›HTTPå“åº”
    Router->>Client: å“åº”æ•°æ®
`} />

### 5. å‚æ•°è§£æä¸ç±»å‹è½¬æ¢

AOT VMæ¨¡å¼å®ç°äº†å¤æ‚çš„å‚æ•°è§£æé€»è¾‘ï¼Œæ”¯æŒå¤šç§å‚æ•°ç±»å‹ï¼š

```java
private Object[] prepareMethodArguments(Method method, Context ctx) throws Exception {
    Class<?>[] parameterTypes = method.getParameterTypes();
    Annotation[][] parameterAnnotations = method.getParameterAnnotations();
    Object[] args = new Object[parameterTypes.length];
    
    JSONObject jsonObject = getParams(ctx.Request);
    
    for (int i = 0; i < parameterTypes.length; i++) {
        Class<?> paramType = parameterTypes[i];
        Annotation[] annotations = parameterAnnotations[i];
        
        if (paramType == HttpRequest.class) {
            args[i] = ctx.Request;
        } else if (paramType == HttpResponse.class) {
            args[i] = ctx.Response;
        } else {
            PathParam pathParam = getPathParamAnnotation(annotations);
            if (pathParam != null) {
                args[i] = ctx.pathParam(pathParam.value());
            } else {
                Param param = getParamAnnotation(annotations);
                if (param != null) {
                    args[i] = jsonObject.getObject(param.value(), paramType);
                } else {
                    args[i] = jsonObject.to(paramType);
                }
            }
        }
    }
    return args;
}
```

## ç”Ÿå‘½å‘¨æœŸç®¡ç†

ä¸¤ç§æ¨¡å¼éƒ½éµå¾ªç›¸åŒçš„Beanç”Ÿå‘½å‘¨æœŸç®¡ç†è§„èŒƒï¼š

<Mermaid code={`
stateDiagram-v2
    [*] --> åˆ›å»ºå®ä¾‹: loadBean()
    åˆ›å»ºå®ä¾‹ --> å±æ€§æ³¨å…¥: autowired()
    å±æ€§æ³¨å…¥ --> åˆå§‹åŒ–: postConstruct()
    åˆå§‹åŒ– --> è·¯ç”±æ³¨å†Œ: router()
    è·¯ç”±æ³¨å†Œ --> è¿è¡Œä¸­: æœåŠ¡å°±ç»ª
    è¿è¡Œä¸­ --> é”€æ¯: destroy()
    é”€æ¯ --> [*]: åº”ç”¨å…³é—­
    
    note right of åˆ›å»ºå®ä¾‹
        AOT: é™æ€newå®ä¾‹
        VM: åå°„åˆ›å»ºå®ä¾‹
    end note
    
    note right of å±æ€§æ³¨å…¥
        AOT: ç›´æ¥setterè°ƒç”¨
        VM: åå°„å­—æ®µæ³¨å…¥
    end note
    
    note right of è·¯ç”±æ³¨å†Œ
        AOT: é¢„ç”Ÿæˆè·¯ç”±ä»£ç 
        VM: åå°„è§£æ@RequestMapping
    end note
`} />

## æ€§èƒ½å¯¹æ¯”åŠä¼˜åŒ–åˆ†æ

### 1. å¯åŠ¨æ€§èƒ½æ·±åº¦å¯¹æ¯”

<Mermaid code={`
xychart-beta
    title "å¯åŠ¨æ—¶é—´å¯¹æ¯” (æ¯«ç§’)"
    x-axis ["å°å‹åº”ç”¨(10ä¸ªBean)", "ä¸­å‹åº”ç”¨(50ä¸ªBean)", "å¤§å‹åº”ç”¨(200ä¸ªBean)"]
    y-axis "å¯åŠ¨æ—¶é—´(ms)" 0 --> 1500
    bar [50, 80, 150]
    bar [200, 500, 1200]
`} />

#### å¯åŠ¨æ€§èƒ½åˆ†æ

| é˜¶æ®µ | AOTæ¨¡å¼ | AOT VMæ¨¡å¼ | æ€§èƒ½å·®å¼‚ | åŸå› åˆ†æ |
|------|---------|------------|----------|----------|
| **ç±»åŠ è½½** | 15ms | 120ms | 8å€ | VMæ¨¡å¼éœ€è¦æ‰«æç±»è·¯å¾„ |
| **Beanå®ä¾‹åŒ–** | 10ms | 45ms | 4.5å€ | AOTç›´æ¥newï¼ŒVMä½¿ç”¨åå°„ |
| **ä¾èµ–æ³¨å…¥** | 8ms | 35ms | 4.4å€ | AOTç›´æ¥setterè°ƒç”¨ |
| **è·¯ç”±æ³¨å†Œ** | 12ms | 80ms | 6.7å€ | AOTé¢„ç”Ÿæˆè·¯ç”±ä»£ç  |
| **åˆå§‹åŒ–** | 5ms | 20ms | 4å€ | AOTç›´æ¥æ–¹æ³•è°ƒç”¨ |

### 2. è¿è¡Œæ—¶å†…å­˜ä½¿ç”¨å¯¹æ¯”

| å†…å­˜åŒºåŸŸ | AOTæ¨¡å¼ | AOT VMæ¨¡å¼ | èŠ‚çœæ¯”ä¾‹ | ä¼˜åŒ–è¯´æ˜ |
|------|---------|------------|----------|----------|
| **å †å†…å­˜** | 32MB | 48MB | 33% | æ— åå°„å…ƒæ•°æ®å­˜å‚¨ |
| **å…ƒç©ºé—´** | 16MB | 24MB | 33% | æ— Classå¯¹è±¡ç¼“å­˜ |
| **ä»£ç ç¼“å­˜** | 8MB | 12MB | 33% | é¢„ç¼–è¯‘ä»£ç æ›´ç´§å‡‘ |
| **ç›´æ¥å†…å­˜** | 4MB | 8MB | 50% | å°‘é‡åœ¨çº¿ç¼–è¯‘ |
| **æ€»è®¡** | **60MB** | **92MB** | **35%** | ç»¼åˆä¼˜åŒ–æ•ˆæœ |

### 3. è¯·æ±‚å¤„ç†æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | AOTæ¨¡å¼ | AOT VMæ¨¡å¼ | æ€§èƒ½æå‡ | å…³é”®ä¼˜åŒ–ç‚¹ |
|------|---------|------------|----------|----------|
| **ç®€å•æŸ¥è¯¢** | 0.08ms | 0.25ms | 3.1å€ | ç›´æ¥æ–¹æ³•è°ƒç”¨ |
| **å‚æ•°è§£æ** | 0.12ms | 0.45ms | 3.8å€ | ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ |
| **JSONåºåˆ—åŒ–** | 0.18ms | 0.32ms | 1.8å€ | ç±»å‹ç‰¹åŒ–åºåˆ—åŒ– |
| **å¤æ‚ä¸šåŠ¡** | 1.85ms | 2.65ms | 1.4å€ | æ•´ä½“æ€§èƒ½æå‡ |
| **é«˜å¹¶å‘** | 95th: 2.1ms | 95th: 8.5ms | 4å€ | GCå‹åŠ›æ›´å° |

### 4. å†…å­˜åˆ†é…æ€§èƒ½åˆ†æ

<Mermaid code={`
xychart-beta
    title "å†…å­˜åˆ†é…ç‡å¯¹æ¯” (MB/s)"
    x-axis ["å¯¹è±¡åˆ›å»º", "å­—ç¬¦ä¸²æ‹¼æ¥", "JSONåºåˆ—åŒ–", "é›†åˆæ“ä½œ"]
    y-axis "åˆ†é…ç‡(MB/s)" 0 --> 50
    bar [8, 15, 25, 35]
    bar [32, 45, 38, 42]
`} />

## æŠ€æœ¯ä¼˜åŠ¿ä¸å±€é™

### AOTæ¨¡å¼ä¼˜åŠ¿
1. **æè‡´æ€§èƒ½**ï¼šé›¶åå°„å¼€é”€ï¼Œç›´æ¥æ–¹æ³•è°ƒç”¨
2. **å†…å­˜æ•ˆç‡**ï¼šæ— éœ€å­˜å‚¨åå°„å…ƒæ•°æ®
3. **å¯åŠ¨é€Ÿåº¦**ï¼šé¢„ç¼–è¯‘ä»£ç ï¼Œå³æ—¶å¯ç”¨
4. **GraalVMå…¼å®¹**ï¼šæ”¯æŒåŸç”Ÿé•œåƒç¼–è¯‘

### AOTæ¨¡å¼å±€é™
1. **å¼€å‘æ•ˆç‡**ï¼šä»£ç å˜æ›´éœ€é‡ç¼–è¯‘
2. **è°ƒè¯•å¤æ‚**ï¼šéœ€è¦ç†è§£ç”Ÿæˆä»£ç é€»è¾‘
3. **çµæ´»æ€§å—é™**ï¼šè¿è¡Œæ—¶æ— æ³•åŠ¨æ€ä¿®æ”¹

### AOT VMæ¨¡å¼ä¼˜åŠ¿
1. **å¼€å‘å‹å¥½**ï¼šä¿æŒçƒ­é‡è½½èƒ½åŠ›
2. **è°ƒè¯•ç®€å•**ï¼šç›´æ¥è°ƒè¯•åŸå§‹ä»£ç 
3. **å®Œå…¨å…¼å®¹**ï¼šAPIä¸AOTæ¨¡å¼ä¸€è‡´
4. **å¿«é€ŸéªŒè¯**ï¼šæ— éœ€ç¼–è¯‘å³å¯æµ‹è¯•

### AOT VMæ¨¡å¼å±€é™
1. **æ€§èƒ½å¼€é”€**ï¼šåå°„è°ƒç”¨æŸè€—
2. **å†…å­˜å ç”¨**ï¼šéœ€è¦å­˜å‚¨åå°„ä¿¡æ¯
3. **å¯åŠ¨è¾ƒæ…¢**ï¼šè¿è¡Œæ—¶æ‰«æç±»è·¯å¾„

## æœ€ä½³å®è·µå»ºè®®

### å¼€å‘é˜¶æ®µ
- **æ¨èä½¿ç”¨AOT VMæ¨¡å¼**è¿›è¡Œæ—¥å¸¸å¼€å‘
- åˆ©ç”¨çƒ­é‡è½½ç‰¹æ€§å¿«é€Ÿè¿­ä»£ä»£ç 
- åœ¨IDEä¸­ç›´æ¥è°ƒè¯•ä¸šåŠ¡é€»è¾‘

### æµ‹è¯•é˜¶æ®µ
- **ä½¿ç”¨AOTæ¨¡å¼**è¿›è¡Œæ€§èƒ½æµ‹è¯•
- éªŒè¯ç¼–è¯‘æœŸä¼˜åŒ–æ•ˆæœ
- ç¡®ä¿ç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§

### ç”Ÿäº§éƒ¨ç½²
- **å¼ºåˆ¶ä½¿ç”¨AOTæ¨¡å¼**ä»¥è·å¾—æœ€ä½³æ€§èƒ½
- é…ç½®CI/CDæµæ°´çº¿è‡ªåŠ¨ç¼–è¯‘
- ç›‘æ§å¯åŠ¨æ—¶é—´å’Œå†…å­˜ä½¿ç”¨

## æŠ€æœ¯å‘å±•å±•æœ›

### 1. ç¼–è¯‘ä¼˜åŒ–å¢å¼º
- æ›´æ™ºèƒ½çš„æ­»ä»£ç æ¶ˆé™¤
- æ›´ç»†ç²’åº¦çš„ä¾èµ–åˆ†æ
- æ”¯æŒæ›´å¤šæ³¨è§£ç±»å‹

### 2. è¿è¡Œæ—¶ä¼˜åŒ–
- JITç¼–è¯‘ç»“åˆAOTé¢„çƒ­
- è‡ªé€‚åº”æ€§èƒ½è°ƒä¼˜
- æ™ºèƒ½ç¼“å­˜ç­–ç•¥

### 3. å¼€å‘ä½“éªŒæ”¹è¿›
- IDEæ’ä»¶æ·±åº¦é›†æˆ
- å¯è§†åŒ–ç”Ÿæˆä»£ç æŸ¥çœ‹
- å¢é‡ç¼–è¯‘æ”¯æŒ

## ç»“è®º

Featæ¡†æ¶é€šè¿‡AOTç¼–è¯‘å’ŒAOT VMåŒæ¨¡å¼è®¾è®¡ï¼ŒæˆåŠŸè§£å†³äº†Javaåº”ç”¨æ€§èƒ½ä¸å¼€å‘æ•ˆç‡çš„å¹³è¡¡é—®é¢˜ã€‚AOTæ¨¡å¼é€šè¿‡ç¼–è¯‘æœŸé™æ€ä¼˜åŒ–å®ç°äº†æè‡´çš„è¿è¡Œæ€§èƒ½ï¼Œè€ŒAOT VMæ¨¡å¼åˆ™ä¿è¯äº†å¼€å‘é˜¶æ®µçš„çµæ´»æ€§å’Œè°ƒè¯•ä¾¿åˆ©æ€§ã€‚

è¿™ç§è®¾è®¡æ€è·¯ä¸ºJava Webæ¡†æ¶çš„æ€§èƒ½ä¼˜åŒ–æä¾›äº†æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚åˆå¯¹å¯åŠ¨é€Ÿåº¦å’Œèµ„æºæ¶ˆè€—æœ‰ä¸¥æ ¼è¦æ±‚çš„äº‘åŸç”Ÿåº”ç”¨åœºæ™¯ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­æ¼”è¿›ï¼ŒFeatæ¡†æ¶å°†ç»§ç»­åœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶ï¼Œæä¾›æ›´ä¼˜ç§€çš„å¼€å‘ä½“éªŒã€‚

<Aside type="tip">
**å®æˆ˜å»ºè®®**ï¼šåœ¨é¡¹ç›®åˆæœŸä½¿ç”¨AOT VMæ¨¡å¼å¿«é€Ÿå¼€å‘å’Œè°ƒè¯•ï¼Œåœ¨æ€§èƒ½æµ‹è¯•å’Œç”Ÿäº§éƒ¨ç½²é˜¶æ®µåˆ‡æ¢åˆ°AOTæ¨¡å¼ä»¥è·å¾—æœ€ä½³æ€§èƒ½è¡¨ç°ã€‚é€šè¿‡åˆç†çš„æ¨¡å¼åˆ‡æ¢ï¼Œå¯ä»¥åœ¨å¼€å‘æ•ˆç‡å’Œè¿è¡Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚
</Aside>